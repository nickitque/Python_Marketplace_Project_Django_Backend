{% extends 'core/base.html' %}
{% load menu_dashboard %}

{% block title %}Диалог{% endblock %}


{% block content %}



<section class="text-gray-600 body-font">
  <div class="container py-12 mx-auto flex flex-col">
      <div class="flex flex-col sm:flex-row mt-2">
        <div class="lg:w-1/5 sm:w-3/5 text-center sm:pr-2">
        <div class="rounded-xl mt-3 h-full px-3 py-4 overflow-y-auto bg-gray-200 dark:bg-gray-800">
        <h2 class="text-xl sm:col-start-1 bg-gray-400 rounded-xl mb-4 p-2">Панель управления</h2>

              <ul class="space-y-2 font-medium">
                 <li>
                    <a href="{% url 'item:new' %}" class="flex items-center p-2 text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 group">
                    <svg class="ml-0.5 w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M7 5C5.34315 5 4 6.34315 4 8V16C4 17.6569 5.34315 19 7 19H17C18.6569 19 20 17.6569 20 16V12.5C20 11.9477 20.4477 11.5 21 11.5C21.5523 11.5 22 11.9477 22 12.5V16C22 18.7614 19.7614 21 17 21H7C4.23858 21 2 18.7614 2 16V8C2 5.23858 4.23858 3 7 3H10.5C11.0523 3 11.5 3.44772 11.5 4C11.5 4.55228 11.0523 5 10.5 5H7Z" fill="#000000"></path> <path fill-rule="evenodd" clip-rule="evenodd" d="M18.8431 3.58579C18.0621 2.80474 16.7957 2.80474 16.0147 3.58579L11.6806 7.91992L11.0148 11.9455C10.8917 12.6897 11.537 13.3342 12.281 13.21L16.3011 12.5394L20.6347 8.20582C21.4158 7.42477 21.4158 6.15844 20.6347 5.37739L18.8431 3.58579ZM13.1933 11.0302L13.5489 8.87995L17.4289 5L19.2205 6.7916L15.34 10.6721L13.1933 11.0302Z" fill="#000000"></path> </g></svg>
                       <span class="ms-3">Новое объявление</span>
                    </a>
                 </li>
                 <li>
                    <a href="{%url 'dashboard:index' %}" class="flex items-center p-2 text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 group">
                        <svg class="w-7 h-7" viewBox="-0.5 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M19 3.32001H16C14.8954 3.32001 14 4.21544 14 5.32001V8.32001C14 9.42458 14.8954 10.32 16 10.32H19C20.1046 10.32 21 9.42458 21 8.32001V5.32001C21 4.21544 20.1046 3.32001 19 3.32001Z" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M8 3.32001H5C3.89543 3.32001 3 4.21544 3 5.32001V8.32001C3 9.42458 3.89543 10.32 5 10.32H8C9.10457 10.32 10 9.42458 10 8.32001V5.32001C10 4.21544 9.10457 3.32001 8 3.32001Z" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M19 14.32H16C14.8954 14.32 14 15.2154 14 16.32V19.32C14 20.4246 14.8954 21.32 16 21.32H19C20.1046 21.32 21 20.4246 21 19.32V16.32C21 15.2154 20.1046 14.32 19 14.32Z" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M8 14.32H5C3.89543 14.32 3 15.2154 3 16.32V19.32C3 20.4246 3.89543 21.32 5 21.32H8C9.10457 21.32 10 20.4246 10 19.32V16.32C10 15.2154 9.10457 14.32 8 14.32Z" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
                       <span class="ms-3 whitespace-nowrap">Мои объявления</span>
                       <span class="inline-flex items-center justify-center px-2 ms-3 text-sm font-medium text-gray-800 bg-gray-100 rounded-full dark:bg-gray-700 dark:text-gray-300">{{ items.count }}</span>
                    </a>
                 </li>
                 <li>
                    <a href="{% url 'conversation:inbox' %}" class="flex items-start p-2 text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 group">
                        <svg class="w-7 h-7" viewBox="0 0 192 192" xmlns="http://www.w3.org/2000/svg" fill="none"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path fill="#000000" d="M18.5 46v-6a6 6 0 0 0-4.243 10.243L18.5 46ZM42 52h104V40H42v12Zm118 14v60h12V66h-12Zm-14 74H62v12h84v-12ZM42 40H18.5v12H42V40Zm6 86V76.127H36V126h12ZM14.257 50.243l18.814 18.813 8.485-8.485-18.813-18.814-8.486 8.486ZM48 76.127a22 22 0 0 0-6.444-15.556l-8.485 8.485A10 10 0 0 1 36 76.127h12ZM62 140c-7.732 0-14-6.268-14-14H36c0 14.359 11.64 26 26 26v-12Zm98-14c0 7.732-6.268 14-14 14v12c14.359 0 26-11.641 26-26h-12Zm-14-74c7.732 0 14 6.268 14 14h12c0-14.36-11.641-26-26-26v12Z"></path><path stroke="#000000" stroke-linecap="round" stroke-linejoin="round" stroke-width="12" d="M66 84h76m-76 24h44"></path></g></svg>
                       <span class="ms-3 whitespace-nowrap">Сообщения</span>
                       <span class="inline-flex items-center justify-center w-3 h-3 p-3 ms-3 text-sm font-medium text-blue-800 bg-blue-100 rounded-full dark:bg-blue-900 dark:text-blue-300">3</span>
                    </a>
                 </li>
                 <li>
                   <a href="{% url 'dashboard:favorites' %}" class="flex items-center p-2 text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 group">
                    <svg class="w-7 h-7" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path fill-rule="evenodd" clip-rule="evenodd" d="M11.993 5.09691C11.0387 4.25883 9.78328 3.75 8.40796 3.75C5.42122 3.75 3 6.1497 3 9.10988C3 10.473 3.50639 11.7242 4.35199 12.67L12 20.25L19.4216 12.8944L19.641 12.6631C20.4866 11.7172 21 10.473 21 9.10988C21 6.1497 18.5788 3.75 15.592 3.75C14.2167 3.75 12.9613 4.25883 12.007 5.09692L12 5.08998L11.993 5.09691ZM12 7.09938L12.0549 7.14755L12.9079 6.30208L12.9968 6.22399C13.6868 5.61806 14.5932 5.25 15.592 5.25C17.763 5.25 19.5 6.99073 19.5 9.10988C19.5 10.0813 19.1385 10.9674 18.5363 11.6481L18.3492 11.8453L12 18.1381L5.44274 11.6391C4.85393 10.9658 4.5 10.0809 4.5 9.10988C4.5 6.99073 6.23699 5.25 8.40796 5.25C9.40675 5.25 10.3132 5.61806 11.0032 6.22398L11.0921 6.30203L11.9452 7.14752L12 7.09938Z" fill="#080341"></path> </g></svg>
                       <span class="ms-3 whitespace-nowrap">Избранное</span>
                    </a>
                 </li>

                    <a href="{% url 'dashboard:account' %}" class="flex items-center p-2 text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 group">
                    <svg class="w-6 h-6" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g id="icomoon-ignore"> </g> <path d="M28.262 5.87c0-1.472-1.194-2.665-2.666-2.665s-2.666 1.193-2.666 2.665c0 1.289 0.916 2.365 2.133 2.612v18.18h1.066v-18.18c1.217-0.247 2.133-1.323 2.133-2.612zM25.596 7.47c-0.882 0-1.599-0.717-1.599-1.599s0.717-1.599 1.599-1.599c0.882 0 1.599 0.717 1.599 1.599s-0.717 1.599-1.599 1.599z" fill="#000000"> </path> <path d="M6.937 23.517v-18.18h-1.066v18.18c-1.217 0.247-2.132 1.322-2.132 2.612 0 1.472 1.194 2.666 2.666 2.666s2.666-1.194 2.666-2.666c0-1.29-0.916-2.365-2.133-2.612zM6.404 27.729c-0.882 0-1.599-0.717-1.599-1.599s0.717-1.599 1.599-1.599 1.599 0.717 1.599 1.599-0.717 1.599-1.599 1.599z" fill="#000000"> </path> <path d="M16.533 13.388v-8.050h-1.066v8.050c-1.217 0.247-2.133 1.323-2.133 2.612s0.916 2.365 2.133 2.612v8.050h1.066v-8.050c1.217-0.247 2.133-1.323 2.133-2.612s-0.916-2.365-2.133-2.612zM16 17.599c-0.882 0-1.599-0.717-1.599-1.599s0.717-1.599 1.599-1.599 1.599 0.717 1.599 1.599-0.717 1.599-1.599 1.599z" fill="#000000"> </path> </g></svg>
                       <span class="ms-3 whitespace-nowrap">Управление аккаунтом</span>
                    </a>
                 </li>
              </ul>
           </div>
        </div>


          <!--Items loop-->
<div class="flex flex-wrap mt-3.5">
<div class="w-full max-w-md p-4 bg-white border border-gray-200 rounded-lg shadow sm:p-8 dark:bg-gray-800 dark:border-gray-700">
    <div class="flex items-center justify-between mb-4">
        <h5 class="text-xl font-bold leading-none text-gray-900 dark:text-white">Ваши Чаты</h5>
        <a href="#" class="text-sm font-medium text-blue-600 hover:underline dark:text-blue-500"></a>
    </div>
   <div class="flow-root">
        <ul role="list" class="divide-y divide-gray-200 dark:divide-gray-700">
        {% for conversation in conversations %}
            <a href="{% url 'conversation:detail' conversation.id %}">
                <!-- {% if message.created_by == request.user %} bg-blue-100 {% else %} bg-gray-100 {% endif %} -->
            <li class="{% if conversation.id == pk %} bg-gray-300 rounded-xl px-2 {% else %} {% endif %} py-3 sm:py-4">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <img class="w-24 rounded-xl" src="{{ conversation.item.image.url }}" alt="Neil image">
                    </div>
                    <div class="flex-1 min-w-0 ms-4">
                    {% for member in conversation.members.all %}
                        {% if member != request.user%}
                        <p class="text-sm font-medium text-gray-900 truncate dark:text-white">{{ member.username }}</p>
                        <p class="text-sm text-gray-500 truncate dark:text-gray-400">
                            {{ conversation.item.name }}
                        </p>
                    {% endif %}
                    {% endfor %}
                    </div>
                    <div class="ml-8 inline-flex items-center text-base font-semibold text-gray-900 dark:text-white">
                        <!--placeholder-->
                    </div>
                </div>
            </li>
            </a>
           {% endfor %}
            </ul>
           </div>
        </div>
    </div>

<div class="flex flex-wrap ml-3 mt-3.5">
<div class="w-full max-w-md p-4 bg-white border border-gray-200 rounded-lg shadow sm:p-8 dark:bg-gray-800 dark:border-gray-700">
    <div class="flex items-center justify-between mb-4">
        {% for member in conversation.members.all %}
        {% if member != request.user %}<h5 class="text-xl font-bold leading-none text-gray-900 dark:text-white">Диалог с <a href="{% url 'dashboard:seller_detail' member.id %}" class="text-indigo-500">{{ member.username }}</a></h5>
         <a href="{% url 'item:detail' conversation.item.category.slug conversation.item.id %}" class="text-sm font-medium text-blue-600 hover:underline dark:text-blue-500">Смотреть объявление </a>{% endif %}
        {% endfor %}
    </div>
   <div class="flow-root">
        <ul role="list" class="divide-y divide-gray-200 dark:divide-gray-700">
            {% for message in conversation.messages.all %}
                <!-- {% if message.created_by == request.user %} bg-blue-100 {% else %} bg-gray-100 {% endif %} -->
            <li class="py-3 sm:py-4">
                <div class="flex items-center">
                    {% if message.created_by == request.user %}
                    <div class="flex-shrink-0">
                        <img class="w-14 rounded-full" {% if message.created_by == request.user %} src="{{ request.user.profile.photo.url }}"{% else %} src="{{ user.profile.photo.url }}" {% endif %}>
                    </div>
                    <div class="flex-1 min-w-0 ms-4">
                        <p class="text-sm font-medium text-gray-900 truncate dark:text-white">{{ message.created_by.username }} <span class="text-sm text-gray-400">{{ message.created_at }}</span></p>
                        <p class="text-sm text-gray-500 dark:text-gray-400">{{ message.content }}</p>
                    </div>
                    {% else %}
                    <div class="px-8 flex-1 min-w-0 ms-4">
                        <p class="text-sm font-medium text-gray-900 dark:text-white"><span class="text-sm text-gray-400">{{ message.created_at }}</span> {{ message.created_by.username }}</p>
                        <p class="text-sm text-gray-500  dark:text-gray-400">{{ message.content }}</p>
                    </div>
                    <div class="flex-shrink-0">
                        <img class="ml-5 w-14 rounded-full" src="{{ message.created_by.profile.photo.url }}">
                    </div>
                    {% endif %}
                    <div class="ml-8 inline-flex items-center text-base font-semibold text-gray-900 dark:text-white">
                        <!--placeholder-->
                    </div>
                </div>
            </li>
           {% endfor %}
            </ul>
   <form method="post">
    <label for="content" class="sr-only">Your message</label>
       {% csrf_token %}
    <div class="flex items-center mb-2 py-2 rounded-lg bg-gray-50 dark:bg-gray-700">
        <textarea name="content" id="content" rows="1" class="block mx-2 p-2.5 w-full text-sm text-gray-900 bg-white rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Ваше сообщение..."></textarea>
            <button type="submit" class="inline-flex justify-center p-2 text-blue-600 rounded-full cursor-pointer hover:bg-blue-100 dark:text-blue-500 dark:hover:bg-gray-600">
            <svg class="w-5 h-5 rotate-90 rtl:-rotate-90" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 18 20">
                <path d="m17.914 18.594-8-18a1 1 0 0 0-1.828 0l-8 18a1 1 0 0 0 1.157 1.376L8 18.281V9a1 1 0 0 1 2 0v9.281l6.758 1.689a1 1 0 0 0 1.156-1.376Z"/>
            </svg>
            <span class="sr-only">Отправить</span>
        </button>
    </div>
</form>
           </div>
        </div>
    </div>
</div>

</div>


<!--End items loop-->
        </div>
      </div>
    </div>
  </div>
</section>

{% endblock %}