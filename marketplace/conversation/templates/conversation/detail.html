{% extends 'core/base.html' %}
{% load menu_dashboard %}

{% block title %}Диалог{% endblock %}


{% block content %}
{% menu_dashboard %}


<div class="ml-5">
    {% for conversation in conversations %}
    <a href="{% url 'conversation:detail' conversation.id %}">
        <div class="p-6 mb-4 flex {% if conversation.id == pk %} bg-gray-300 {% else %} bg-gray-100 {% endif %} rounded-xl">
            <div class="pr-6">
                <div>
                    <span class="inline-flex items-baseline">
                    <img src="{{ conversation.item.image.url }}" class="w-20 mr-3 rounded-xl" alt="">
                    {% for member in conversation.members.all %}
                        {% if member != request.user%}
                        <p class="mb-4"><strong>{{ member.username }}</strong> | {{ conversation.modified_at }}</p></span>
                            <p>{{ conversation.item.name }}</p>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </a>
    {% endfor %}
</div>

    <div class="ml-4 border-4 rounded-xl">
    {% for message in conversation.messages.all %}
        <div class="m-4 flex flex-col w-full max-w-[480px] leading-1.5 p-4 border-gray-200 bg-gray-100 rounded-e-xl rounded-xl dark:bg-gray-700 {% if message.created_by == request.user %} bg-indigo-100 {% else %}  {% endif %}">
          <div class="flex items-center space-x-2 rtl:space-x-reverse">
              <img class="w-8 h-8 rounded-full" src="{{ profile.photo.url }}" alt="">
              <span class="text-sm font-semibold text-gray-900 dark:text-white">{{ message.created_by.username }}</span>
              <span class="text-sm font-normal text-gray-500 dark:text-gray-400">| {{ message.created_at }}</span>
          </div>
          <p class="ml-4 text-sm font-normal py-2.5 text-gray-900 dark:text-white">{{ message.content }}</p>
        </div>
    {% endfor %}

    <div class="flex flex-col w-full max-w-[520px] leading-1.5 p-4 border-gray-200 bg-gray-100 rounded-xl rounded-es-xl dark:bg-gray-700">
    <form method="post" action='.' class="">
    {% csrf_token %}
    <div>{{ form.as_p }}</div>
        <button class="py-4 px-8 text-lg bg-teal-500">Отправить</button>
</form>
</div>
    </div>
{% endblock %}
</div>